(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{ac21:function(t,e,s){},b3ad:function(t,e,s){"use strict";s("ac21")},bb6e:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",[s("activity")],1)},a=[],o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("header_vel",[t._v("\n        Actividades\n    ")]),s("q-btn",{attrs:{label:"crear",icon:"add"},on:{click:function(e){t.showModal=!t.showModal}}}),s("q-dialog",{staticClass:"flex flex-center",attrs:{persistent:"",maximized:t.maximizedToggle,"transition-show":"slide-up","transition-hide":"slide-down"},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[s("supplierForm")],1),t.activity.length>0?s("q-list",{attrs:{dark:"",bordered:"",separator:""}},t._l(t.activity,(function(t,e){return s("supplierCard",{key:e,attrs:{activity:t}})})),1):t._e()],1)},n=[],r=s("31f7"),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"  item-vel full-width q-pa-md"},[s("div",{staticClass:"content_item row q-mt-md"},[s("div",{staticClass:"col-10 q-pt-md"},[s("div",[t._v(" "+t._s(t.activity.description))]),s("div",[t._v(" Cliente: "+t._s(t.activity.cost_center.client.name))]),s("div",[t._v(" Centro de costo: "+t._s(t.activity.cost_center.name))]),s("div",[t._v(" Status: "+t._s(1===t.activity.status?"Activo":"cerrado"))]),s("div",[t._v(" Fecha de Solicitud: "+t._s(t.formated(t.activity.created_at,!0)))]),s("div",[t._v(" Fecha de Ultima actualizacion: "+t._s(t.formated(t.activity.updated_at,!0)))]),t.length>0?s("div",[s("div",[t._v("estatus de los materiales:")]),s("q-linear-progress",{attrs:{size:"25px",value:t.percentage,color:"green"}},[s("div",{staticClass:"absolute-full flex flex-center"},[s("q-badge",{attrs:{color:"white","text-color":"accent",label:t.material_status}})],1)])],1):t._e(),t.activity.demands.length>0?s("div",[s("div",[t._v("estatus de los requerimientos:")]),s("q-linear-progress",{attrs:{size:"25px",value:t.percentage_demands,color:"green"}},[s("div",{staticClass:"absolute-full flex flex-center"},[s("q-badge",{attrs:{color:"white","text-color":"accent",label:t.demands_status}})],1)])],1):t._e()]),s("div",{staticClass:"col-2 "},[0==t.activity.budgets.length?s("q-btn",{attrs:{flat:"",dense:"",icon:"upload"},on:{click:function(e){t.showPresupuesto=!t.showPresupuesto}}}):t._e(),t.activity.budgets.length>0?s("q-btn",{attrs:{flat:"",dense:"",icon:"visibility"},on:{click:t.mostrar}}):t._e(),s("q-btn",{attrs:{flat:"",dense:"",icon:"edit"},on:{click:function(e){t.showForm=!t.showForm}}}),s("q-btn",{attrs:{flat:"",dense:"",icon:"delete"},on:{click:function(e){t.showDelete=!t.showDelete}}})],1)]),s("dropCard",{attrs:{btn_class:"full-width"}},[s("div",{staticClass:"text-h6 text-center text-green"},[t._v("\n                Requerimientos\n            ")]),s("div",{staticClass:"row bg-blue text-white q-pa-sm text-center"},[s("div",{staticClass:"col-4"},[t._v("\n                    Numero de Control\n                ")]),s("div",{staticClass:"col-4"},[t._v("\n                    Ultima actualizacion\n                ")]),s("div",{staticClass:"col-4"},[t._v("\n                    status\n                ")])]),t._l(t.activity.demands,(function(e,i){return s("div",{key:i},[s("div",{staticClass:"row q-mt-sm"},[s("div",{staticClass:"col-4"},[t._v("\n                        "+t._s(e.control_number)+"\n                    ")]),s("div",{staticClass:"col-4"},[t._v("\n                        "+t._s(t.formated(e.updated_at,!0))+"\n\n                    ")]),s("div",{staticClass:"col-4"},[t._v("\n                        "+t._s(e.step.step)+"\n                    ")])]),s("dropCard",{attrs:{label:"materiales"}}),s("q-separator",{staticClass:"q-mt-sm"})],1)}))],2)],1),s("q-dialog",{staticClass:"flex flex-center",attrs:{persistent:"",maximized:t.maximizedToggle,"transition-show":"slide-up","transition-hide":"slide-down"},model:{value:t.showPresupuesto,callback:function(e){t.showPresupuesto=e},expression:"showPresupuesto"}},[s("Presupuesto",{attrs:{activity:t.activity}})],1),s("q-dialog",{staticClass:"flex flex-center",attrs:{persistent:"",maximized:t.maximizedToggle,"transition-show":"slide-up","transition-hide":"slide-down"},model:{value:t.showViewPresupuesto,callback:function(e){t.showViewPresupuesto=e},expression:"showViewPresupuesto"}},[s("ViewPresupuesto",{attrs:{activity:t.activity}})],1),s("q-dialog",{staticClass:"flex flex-center",attrs:{persistent:"",maximized:t.maximizedToggle,"transition-show":"slide-up","transition-hide":"slide-down"},model:{value:t.showForm,callback:function(e){t.showForm=e},expression:"showForm"}},[s("supplierForm",{attrs:{activity:t.activity}})],1),s("q-dialog",{model:{value:t.showDelete,callback:function(e){t.showDelete=e},expression:"showDelete"}},[s("deleteModal",{attrs:{_id:t.activity._id}})],1)],1)},c=[],d=(s("159b"),s("99af"),s("13d5"),s("07ac"),s("4e82"),s("b0c0"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t._v("My component")])}),u=[],p={data:function(){return{}}},m=p,h=s("2877"),v=Object(h["a"])(m,d,u,!1,null,null,null),f=v.exports,_=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"  flex flex-center"},[s("q-card",{staticClass:"full-width "},[s("q-bar",[s("q-space"),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",flat:"",icon:"close"}},[s("q-tooltip",{attrs:{"content-class":"bg-white text-primary"}},[t._v("Close")])],1)],1),s("q-card-section",[s("div",{staticClass:"text-h6 text-primary"},[t._v("\n                Presupuesto\n            ")])]),s("q-form",{staticClass:" q-gutter-md",on:{submit:t.store}},[s("q-btn",{staticClass:"aboo_btn bg-orange q-ml-lg",on:{click:t.subir}},[t._v(t._s(t.archivo?"Crear Presupuesto":"Subir Archivo"))]),t.archivo?s("q-file",{attrs:{color:"teal",label:"Subir Presupuesto"},scopedSlots:t._u([{key:"prepend",fn:function(){return[s("q-icon",{attrs:{name:"cloud_upload"}})]},proxy:!0}],null,!1,1406165409),model:{value:t.file,callback:function(e){t.file=e},expression:"file"}}):t._e(),t.archivo?t._e():s("div",{staticClass:"q-mb-lg"},[t._l(t.items,(function(e,i){return s("div",{key:i,staticClass:"row"},[s("q-input",{attrs:{type:"text",hint:"Nombre"},model:{value:e.name,callback:function(s){t.$set(e,"name",s)},expression:"item.name"}}),s("q-input",{attrs:{type:"number",hint:"Precio"},model:{value:e.price,callback:function(s){t.$set(e,"price",s)},expression:"item.price"}})],1)})),s("div",[s("q-btn",{staticClass:"aboo_btn bg-blue q-mt-lg",on:{click:t.agregar}},[t._v("Agregar item")])],1)],2),s("div",{staticClass:"row"},[s("div",{staticClass:"col-6 q-pa-sm"},[s("q-btn",{staticClass:"aboo_btn bg-green full-width",attrs:{label:"Guardar",loading:t.loading,type:"submit"}})],1),s("div",{staticClass:"col-6 q-pa-sm"},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"aboo_btn  bg-red-4 full-width",attrs:{label:"Cancelar",id:"close_form"}})],1)])],1)],1),s("q-dialog",{model:{value:t.showCostForm,callback:function(e){t.showCostForm=e},expression:"showCostForm"}},[s("centerForm",{attrs:{clients:t.clients,client_id:t.client_id}})],1),s("q-dialog",{model:{value:t.showCategortyForm,callback:function(e){t.showCategortyForm=e},expression:"showCategortyForm"}},[s("categoryForm")],1)],1)},g=[],b=(s("4de4"),s("125f")),w=s("04f9"),y={name:"supplierForm",data:function(){return{loading:!1,description:null,showCostForm:!1,cost_center:[],cost_center_back:[],categories:[],clients:[],client_id:null,showCategortyForm:!1,archivo:!1,file:null,items:[{name:"",price:""}]}},components:{centerForm:b["a"],categoryForm:w["a"]},watch:{client_id:function(t,e){console.log(t),this.cost_center=this.cost_center_back.filter((function(e){return e.client_id===t}))}},computed:{},props:{activity:{type:Object,default:function(){return{id:null,description:null,center_cost_id:null,category_id:null}}}},methods:{store:function(){var t=this;if(this.archivo){this.file||this.$q.notify({message:"Suba un archivo",color:"red",position:"right"});var e=new FormData;e.append("file",this.file),e.append("id",this.activity.id),axios.post("activity/budget",e).then((function(e){console.log(e),t.$q.notify({message:"Guardado Correctamente",color:"green",position:"right"}),t.$root.$emit("activity_refresh"),t.$root.$emit("close_presupuesto")})).catch((function(t){console.log(t)}))}else{this.items.forEach((function(e){if(""==e.name||""==e.price||0==e.price)return!0,void t.$q.notify({message:"Llene todo el formulario",color:"red",position:"right"})}));var s={items:this.items,id:this.activity.id};axios.post("activity/budget",s).then((function(e){console.log(e),t.$q.notify({message:"Guardado Correctamente",color:"green",position:"right"})})).catch((function(t){console.log(t)}))}},subir:function(){this.archivo&&(this.file=null),this.archivo=!this.archivo},agregar:function(){var t={name:"",price:""};this.items.push(t)}},mounted:function(){var t=this;this.getCostCenter(),this.$root.$on("new_center_cost",(function(e){t.cost_center.push(e),t.showCostForm=!1,t.activity.center_cost_id=e.id})),this.$root.$on("new_Category",(function(e){t.categories.push(e),t.showCategortyForm=!1,t.activity.category_id=e.id}))}},C=y,q=(s("b3ad"),s("f09f")),x=s("d847"),F=s("2c91"),k=s("9c40"),$=s("05c0"),Q=s("a370"),P=s("0378"),S=s("7d53"),z=s("0016"),j=s("27f9"),D=s("24e8"),E=s("7f67"),M=s("eebe"),O=s.n(M),A=Object(h["a"])(C,_,g,!1,null,null,null),T=A.exports;O()(A,"components",{QCard:q["a"],QBar:x["a"],QSpace:F["a"],QBtn:k["a"],QTooltip:$["a"],QCardSection:Q["a"],QForm:P["a"],QFile:S["a"],QIcon:z["a"],QInput:j["a"],QDialog:D["a"]}),O()(A,"directives",{ClosePopup:E["a"]});var B=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"  flex flex-center"},[s("q-card",{staticClass:"full-width "},[s("q-bar",[s("q-space"),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",flat:"",icon:"close"}},[s("q-tooltip",{attrs:{"content-class":"bg-white text-primary"}},[t._v("Close")])],1)],1),s("q-card-section",[s("div",{staticClass:"text-h6 text-primary"},[t._v("\n                Presupuesto\n            ")])]),s("q-card-section",[s("q-list",{attrs:{bordered:"",separator:""}},t._l(t.activity.budgets,(function(e,i){return s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:i,attrs:{clickable:""}},[s("q-item-section",[s("q-item-label",[t._v("Presupuesto "+t._s(i+1))]),s("q-item-label",{attrs:{caption:"",lines:"2"}},[null==e.approved?s("q-btn",{staticClass:"glossy",attrs:{size:"sm",outline:"",label:"aprobar",color:"green",icon:"done_all"},on:{click:function(s){return t.changeStatus(!0,e.id)}}}):t._e(),null==e.approved?s("q-btn",{staticClass:"glossy",attrs:{size:"sm",label:"rechazar",outline:"",color:"red",icon:"block"},on:{click:function(s){return t.changeStatus(!1,e.id)}}}):t._e()],1)],1),s("q-item-section",{attrs:{side:"",top:""}},[s("q-icon",{attrs:{name:e.btn},on:{click:function(s){return t.descargar(e)}}}),null==e.approved?s("div",[t._v("Por Aprobar")]):t._e(),e.approved?s("div",[t._v("Aprobado")]):t._e(),0==e.approved?s("div",[t._v("Rechazado")]):t._e()],1)],1)})),1),t.show?s("div",{staticClass:"content dropCard",attrs:{"transition-show":"jump-down"}},t._l(t.details,(function(e,i){return s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:i,staticStyle:{"border-button":"1px solid #eee"},attrs:{clickable:""}},[s("q-item-section",[t._v("\n                        "+t._s(e.name)+"\n                    ")]),s("q-item-section",{attrs:{side:""}},[t._v("\n                        "+t._s(e.price)+" $\n                    ")])],1)})),1):t._e()],1)],1),s("q-dialog",{model:{value:t.showCostForm,callback:function(e){t.showCostForm=e},expression:"showCostForm"}},[s("centerForm",{attrs:{clients:t.clients,client_id:t.client_id}})],1),s("q-dialog",{model:{value:t.showCategortyForm,callback:function(e){t.showCategortyForm=e},expression:"showCategortyForm"}},[s("categoryForm")],1)],1)},L=[],N=(s("ac1f"),s("1276"),s("e260"),s("d3b7"),s("3ca3"),s("ddb0"),s("2b3d"),{name:"supplierForm",data:function(){return{loading:!1,description:null,showCostForm:!1,cost_center:[],cost_center_back:[],categories:[],clients:[],client_id:null,showCategortyForm:!1,archivo:!1,file:null,items:[{name:"",price:""}],show:!1,details:[]}},components:{centerForm:b["a"],categoryForm:w["a"]},watch:{client_id:function(t,e){console.log(t),this.cost_center=this.cost_center_back.filter((function(e){return e.client_id===t}))}},computed:{},props:{activity:{type:Object,default:function(){return{id:null,description:null,center_cost_id:null,category_id:null}}}},methods:{descargar:function(t){if("download"==t.btn){var e=t.details[0].path.split("/").pop();axios({url:"download/"+e,method:"GET",responseType:"blob"}).then((function(t){var s=window.URL.createObjectURL(new Blob([t.data])),i=document.createElement("a");i.href=s,i.setAttribute("download",e),document.body.appendChild(i),i.click()})).catch((function(t){}))}else this.show=!this.show,this.details=t.details},changeStatus:function(t,e){var s=this,i={id:e,selection:t};axios.post("budgets/approve",i).then((function(t){s.$root.$emit("activity_refresh")})).catch((function(t){}))}},mounted:function(){var t=this;this.activity.budgets.forEach((function(e){e.details.forEach((function(t){t.name&&t.price?(e["btn"]="visibility",e["show"]=!1):e["btn"]="download"})),t.$forceUpdate()}))}}),V=N,I=s("1c1c"),R=s("66e5"),U=s("4074"),G=s("0170"),J=s("714f"),H=Object(h["a"])(V,B,L,!1,null,null,null),K=H.exports;O()(H,"components",{QCard:q["a"],QBar:x["a"],QSpace:F["a"],QBtn:k["a"],QTooltip:$["a"],QCardSection:Q["a"],QList:I["a"],QItem:R["a"],QItemSection:U["a"],QItemLabel:G["a"],QIcon:z["a"],QDialog:D["a"]}),O()(H,"directives",{ClosePopup:E["a"],Ripple:J["a"]});var W=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.show?s("div",{staticClass:"content dropCard",attrs:{"transition-show":"jump-down"}},[t._t("default")],2):t._e(),s("q-btn",{staticClass:"dropCard_buttom",class:t.btn_class,attrs:{label:t.label,icon:t.show?"expand_less":"expand_more",flat:""},on:{click:function(e){t.show=!t.show}}})],1)},X=[],Y={data:function(){return{show:!1}},props:{btn_class:"",label:null}},Z=Y,tt=Object(h["a"])(Z,W,X,!1,null,null,null),et=tt.exports;O()(tt,"components",{QBtn:k["a"]});var st=s("8d47"),it={data:function(){return{showForm:!1,showDelete:!1,maximizedToggle:!0,showPresupuesto:!1,showViewPresupuesto:!1,materials:[],length:0,material_status:null,percentage:.5,percentage_demands:0,demands_status:null,demands:[]}},methods:{formated:st["a"],setMaterials:function(){var t=[];this.activity.demands.forEach((function(e){t=t.concat(e.materials)})),this.demands=this.activity.demands.reduce((function(t,e){return t[e.step.step]||(t[e.step.step]=[]),t[e.step.step].push(e),t}),{}),this.demands=Object.values(this.demands),this.demands.sort((function(t,e){return e.length-t.length})),this.percentageStatusDemands(this.demands[0],this.activity.demands.length),this.materials=t.reduce((function(t,e){return t[e.status.name]||(t[e.status.name]=[]),t[e.status.name].push(e),t}),{}),this.materials=Object.values(this.materials),this.materials.sort((function(t,e){return e.length-t.length})),this.length=t.length,this.percentageStatus(this.materials[0])},percentageStatus:function(t){console.log(this.length);var e=100*t.length/this.length;this.material_status=e+"% "+t[0].status.name,this.percentage=e/100},percentageStatusDemands:function(t,e){var s=100*t.length/e;this.demands_status=s+"% "+t[0].step.step,this.percentage_demands=s/100},mostrar:function(){this.showViewPresupuesto=!0}},components:{supplierForm:r["a"],deleteModal:f,dropCard:et,Presupuesto:T,ViewPresupuesto:K},props:["activity"],mounted:function(){var t=this;this.$root.$on("close_delete",(function(){t.showDelete=!1})),this.$root.$on("close_presupuesto",(function(){t.showPresupuesto=!1})),this.setMaterials()}},at=it,ot=s("6b1d"),nt=s("58a81"),rt=s("eb85"),lt=Object(h["a"])(at,l,c,!1,null,null,null),ct=lt.exports;O()(lt,"components",{QLinearProgress:ot["a"],QBadge:nt["a"],QBtn:k["a"],QSeparator:rt["a"],QDialog:D["a"]});var dt=s("d784d"),ut={data:function(){return{showModal:!1,maximizedToggle:!0,activity:[]}},components:{supplierForm:r["a"],supplierCard:ct,header_vel:dt["a"]},methods:{getActivity:function(){var t=this;this.$q.loading.show(),axios.get("/activity/index").then((function(e){t.$q.loading.hide(),console.log(e),t.activity=e.data})).catch((function(e){console.log(e),t.$q.loading.hide()}))}},mounted:function(){var t=this;this.getActivity(),this.$root.$on("activity_refresh",(function(){t.getActivity(),t.showModal=!1}))}},pt=ut,mt=Object(h["a"])(pt,o,n,!1,null,null,null),ht=mt.exports;O()(mt,"components",{QBtn:k["a"],QDialog:D["a"],QList:I["a"]});var vt={components:{activity:ht}},ft=vt,_t=s("9989"),gt=Object(h["a"])(ft,i,a,!1,null,null,null);e["default"]=gt.exports;O()(gt,"components",{QPage:_t["a"]})}}]);