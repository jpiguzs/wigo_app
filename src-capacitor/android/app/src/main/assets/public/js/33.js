(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[33],{"09a3":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",[a("permission")],1)},r=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("header_vel",[e._v("\n    Permiso Especial\n")]),a("div",[a("q-card",{staticClass:"full-width",staticStyle:{"min-width":"300px"}},[e.orders.length>0?a("q-list",{staticClass:"text-black",attrs:{dark:"",bordered:"",separator:""}},e._l(e.orders,(function(t,s){return 1==t.special_permission&&t.user_request===e.user.id&&1==t.status?a("poCard",{key:s,attrs:{order:t}}):e._e()})),1):a("q-list",{staticClass:"text-black",attrs:{dark:"",bordered:"",separator:""}},[e._v("\n      Sin orden que procesar\n  ")])],1)],1)],1)},o=[],i=a("c973"),l=a.n(i),c=(a("96cf"),a("d784d")),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("q-expansion-item",{attrs:{"expand-separator":"","header-class":"item-vel bg-blue-grey-11 text-blue"},scopedSlots:e._u([{key:"header",fn:function(){return[a("q-item-section",[a("q-item-label",{staticClass:"text-black"},[e._v("Orden de Compra N # : "),a("strong",[e._v(" "+e._s(e.formatId(e.order.id)))])]),a("q-item-label",{staticClass:"text-black"},[e._v("Fecha :"),a("span",{},[a("strong",[e._v(" "+e._s(e._f("formatDate")(e.order.created_at))+" ")])])]),a("q-item-label",{staticClass:"text-black"},[e._v("Hora :"),a("span",{},[a("strong",[e._v(" "+e._s(e._f("formatTime")(e.order.created_at)))])])])],1)]},proxy:!0}])},[a("q-card",[a("div",[a("q-card-section",{staticClass:"q-mt-md"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 q-pa-sm"},[a("q-btn",{staticClass:"aboo_btn bg-green full-width",attrs:{label:"Agregar al Inventario"},on:{click:function(t){return e.ModalQuantity()}}})],1)])])],1)])],1),a("q-dialog",{staticClass:"flex flex-center ",attrs:{persistent:"",maximized:e.maximizedToggle},model:{value:e.showModalQuantity,callback:function(t){e.showModalQuantity=t},expression:"showModalQuantity"}},[a("q-card",{staticClass:"modal-card"},[a("q-card-section",{staticClass:"bg-primary text-white"},[a("div",{staticClass:"text-subtitle2"},[e._v("Materiales - Permiso Especial")])]),a("q-separator"),a("div",[a("q-card-section",[a("q-form",{staticClass:"aboo_form q-gutter-sm"},[a("q-select",{attrs:{clearable:"","bg-color":"white",outlined:"",options:e.options,"option-value":function(e){return Object(e)===e&&"id"in e?e.id:null},"option-label":function(e){return Object(e)===e&&"name"in e?e.name:""},"emit-value":"","map-options":"",label:"Recibo de:",disable:""},model:{value:e.optionValue,callback:function(t){e.optionValue=t},expression:"optionValue"}}),e.showInterno?a("div",[a("div"),a("div",[a("q-input",{attrs:{disable:"",type:"text",label:"Nombre","label-color":"black"},model:{value:e.nameInterno,callback:function(t){e.nameInterno=t},expression:"nameInterno"}})],1),a("div",[a("q-input",{attrs:{disable:"",type:"text",label:"Apellido","label-color":"black"},model:{value:e.last_nameInterno,callback:function(t){e.last_nameInterno=t},expression:"last_nameInterno"}})],1)]):e._e(),e.showExterno?a("div",[a("div",[a("q-input",{attrs:{type:"text",label:"Nombre",hint:"Nombre Obligatorio","label-color":"black"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),a("div",[a("q-input",{attrs:{type:"text",label:"Apellido",hint:"Apellido Obligatorio","label-color":"black"},model:{value:e.last_name,callback:function(t){e.last_name=t},expression:"last_name"}})],1),a("div",[a("q-input",{attrs:{type:"text",label:"Cedula",hint:"Cedula Obligatorio","label-color":"black"},model:{value:e.cedula,callback:function(t){e.cedula=t},expression:"cedula"}})],1)]):e._e(),a("div",[a("strong",[e._v("Responsable : "+e._s(e.order.request_user.name)+" "+e._s(e.order.request_user.last_name))])]),a("div",[a("iniciedFile",{attrs:{request:e.order}})],1)],1)],1),a("div",{staticClass:"row"},[a("div",{staticClass:"col-6 q-pa-sm"},[a("q-checkbox",{attrs:{color:"secondary",label:"Todos","true-value":"si","false-value":"no"},model:{value:e.allQuantity,callback:function(t){e.allQuantity=t},expression:"allQuantity"}})],1),a("div",{staticClass:"col-6 text-right q-pa-sm "})]),a("form",{on:{submit:function(t){return t.preventDefault(),t.stopPropagation(),e.saveDemandMaterial(t)}}},[e._l(e.rows,(function(t,s){return a("q-card-section",{key:s},[a("div",{staticClass:"text-h6 text-primary"},[a("q-input",{ref:"quantityInput",refInFor:!0,attrs:{label:t.material+" ( Cant :"+t.quantity+" ) ","stack-label":"",disable:t.quantity===t.cantSelected},model:{value:t.cantSelected,callback:function(a){e.$set(t,"cantSelected",a)},expression:"material.cantSelected"}})],1)])})),e.showMotivo?a("q-card-section",[a("div",[a("q-input",{attrs:{filled:"",type:"textarea",label:"Motivo por las cantidades faltantes?"},model:{value:e.motivo,callback:function(t){e.motivo=t},expression:"motivo"}})],1)]):e._e(),a("div",{staticClass:"row"},[a("div",{staticClass:"col-6 q-pa-sm"},[a("q-btn",{staticClass:"aboo_btn bg-green full-width",attrs:{label:"Guardar",type:"submit"}})],1),a("div",{staticClass:"col-6 q-pa-sm"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"aboo_btn  bg-red-4 full-width",attrs:{label:"Cancelar"}})],1)])],2)],1)],1)],1),a("q-dialog",{staticClass:"flex flex-center ",attrs:{persistent:"",maximized:e.maximizedToggle},model:{value:e.showNotaEntrega,callback:function(t){e.showNotaEntrega=t},expression:"showNotaEntrega"}},[a("q-card",{staticClass:"modal-card"},[a("q-card-section",{staticClass:"bg-primary text-white"},[a("div",{staticClass:"text-subtitle2"},[e._v("Nota de Entrega")])]),a("q-separator"),a("div",[a("q-card-section",[a("q-form",{staticClass:"aboo_form q-gutter-sm"},[a("div",[a("strong",[e._v("Yo: "+e._s(e.order.request_user.name)+" "+e._s(e.order.request_user.last_name)+" recibo de:")])]),e.showInterno?a("div",[a("div"),a("div",[a("q-input",{attrs:{disable:"",type:"text",label:"Nombre","label-color":"black"},model:{value:e.nameInterno,callback:function(t){e.nameInterno=t},expression:"nameInterno"}})],1),a("div",[a("q-input",{attrs:{disable:"",type:"text",label:"Apellido","label-color":"black"},model:{value:e.last_nameInterno,callback:function(t){e.last_nameInterno=t},expression:"last_nameInterno"}})],1)]):e._e(),e.showExterno?a("div",[a("div",[a("q-input",{attrs:{type:"text",label:"Nombre","label-color":"black",readonly:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),a("div",[a("q-input",{attrs:{type:"text",label:"Apellido","label-color":"black",readonly:""},model:{value:e.last_name,callback:function(t){e.last_name=t},expression:"last_name"}})],1),a("div",[a("q-input",{attrs:{type:"text",label:"Cedula","label-color":"black",readonly:""},model:{value:e.cedula,callback:function(t){e.cedula=t},expression:"cedula"}})],1)]):e._e(),a("div",[a("strong",[e._v("los siguientes materiales: ")])]),a("div",[a("iniciedFile",{attrs:{request:e.order}})],1)])],1),a("form",[e._l(e.rows,(function(t,s){return a("q-card-section",{key:s},[a("div",{staticClass:"text-h6 text-primary"},[a("q-input",{ref:"quantityInput",refInFor:!0,attrs:{label:t.material+" ( Cant :"+t.quantity+" ) ","stack-label":"",rules:[function(e){return!!e||"* Obligatorio"},function(e){return e<=t.quantity||"La cantidad debe ser menor o igual que "+t.quantity}],disable:!0},model:{value:t.cantSelected,callback:function(a){e.$set(t,"cantSelected",a)},expression:"material.cantSelected"}})],1)])})),e.showMotivo?a("q-card-section",[a("div",[a("q-input",{attrs:{filled:"",type:"textarea",label:"Motivo por las cantidades faltantes?"},model:{value:e.motivo,callback:function(t){e.motivo=t},expression:"motivo"}})],1)]):e._e(),a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 q-pa-sm"},[a("q-btn",{staticClass:"aboo_btn  bg-red-4 full-width",attrs:{label:"Cancelar"},on:{click:function(t){return e.reset()}}})],1)])],2)],1)],1)],1)],1)},u=[],m=(a("ac1f"),a("1276"),a("159b"),a("b0c0"),a("4de4"),a("bd4c")),p=a("4819"),h=a("0a83"),b={data:function(){return{active:1,name:"",last_name:"",cedula:"",nameInterno:"",last_nameInterno:"",userSeleted:"",userFilter:[],options:[{id:1,name:"Interno"},{id:2,name:"Externo"}],optionValue:"",showInterno:!1,showExterno:!1,showMotivo:!1,showPermisoEspecial:!1,showNotaEntrega:!1,motivo:"",showModalQuantity:!1,maximizedToggle:!0,rows:[],columns:[],selected:[],allQuantity:"no",userResponsable:[]}},components:{tabs:p["a"],iniciedFile:h["a"]},props:["order"],computed:{user:{get:function(){return this.$store.getters["auth/user"]}},users:{get:function(){return this.$store.getters["users/users"]}}},filters:{formatDate:function(e){var t=e.split("T"),a=t[0].split("-"),s=new Date(a[0],a[1],a[2]);return m["a"].formatDate(s,"DD-MM-YYYY")},formatTime:function(e){var t=e.split("T"),a=t[1].split(":"),s=new Date(a[0],a[1]);return m["a"].formatDate(s,"hh:mm:ss A")}},watch:{allQuantity:function(e,t){"si"==e?(this.showMotivo=!1,this.rows.forEach((function(e){1==e.quantity?e.cantSelected=e.quantity:e.quantity==e.quantitySeleted?e.cantSelected=e.quantitySeleted:e.cantSelected=e.quantity}))):(this.showMotivo=!0,this.rows.forEach((function(e){e.cantSelected=0})))},optionValue:function(e,t){switch(console.log(e),this.name="",this.last_name="",this.userSeleted="",e){case 1:this.showInterno=!0,this.showExterno=!1;break;case 2:this.showInterno=!1,this.showExterno=!0;break}},userSeleted:function(e,t){console.log("User Selected",e),console.log("User Activo",this.user)}},methods:{filter_user:function(e,t,a){var s=this;e.length<2?a():t((function(){var t=e.toLowerCase();s.userFilter=s.users.filter((function(e){return e.name.toLowerCase().indexOf(t)>-1}))}))},formatId:function(e){for(var t=String(e),a="#",s=4-t.length,r=0;r<s;r++)a+="0";return a+t},cargarTable:function(){var e=this;this.columns=[],this.rows=[],this.columns=[{name:"material",label:"Materiales",align:"center",field:"material",sortable:!0},{name:"quantityTotal",label:"Cantidad",align:"center",field:"quantityTotal",sortable:!0},{name:"quantity",label:"Por Ingresar",align:"center",field:"quantity",sortable:!0},{name:"quantitySeleted",label:"Ingresado",align:"center",field:"quantitySeleted",sortable:!0}];var t=this;this.order.applicants.forEach((function(a){var s={material:a.material.name,quantityTotal:a.material.quantity,quantity:a.material.quantity-a.material.quantity_selected_po,quantitySeleted:a.material.quantity_selected_po,price:a.price,id:a.id,orderId:e.order.id,materialId:a.material_id,inventoryId:null==a.material.inventory_id?0:a.material.inventory_id,cantSelected:a.material.quantity,measureId:a.material.measure_id,quantityEntregada:a.material.quantity_selected,demand_id:a.acp.demand_id};t.rows.push(s)}))},ModalQuantity:function(){this.showModalQuantity=!0},saveDemandMaterial:function(){var e=this;this.responsable();var t=0;this.$refs.quantityInput.forEach((function(e){e.validate()&&t++}));for(var a=0,s=0;s<this.rows.length;s++){if(parseInt(this.$refs.quantityInput[s].value)+parseInt(this.rows[s].quantitySeleted)>this.rows[s].quantityTotal){this.$q.notify({message:"Material que desea registrar supera el que se establecio ",color:"red",position:"right"});break}a++}this.$refs.quantityInput.length===t&&this.rows.length===a?(console.log("Entro aquii bueno"),this.$q.loading.show(),this.$store.dispatch("order/savePurchaseOrder",[this.userResponsable,this.rows]).then((function(t){e.$q.notify({message:"Material Registrado con Exitos",color:"green",position:"right"}),e.showModalQuantity=!1,e.$q.loading.hide(),e.$root.$emit("refresh_order_permission"),console.log(t.data)})).catch((function(e){console.log(e)}))):console.log("Entro aquii malo")},responsable:function(){var e={id:1==this.showInterno?this.userSeleted.id:0,name:1==this.showInterno?this.userSeleted.name:this.name,last_name:1==this.showInterno?this.userSeleted.last_name:this.last_name,motivo:this.motivo,orderId:this.order.id,userResponsable:this.user.id};console.log("UserResponsable",e),this.userResponsable.push(e)},reset:function(){this.showNotaEntrega=!1,this.showInterno=!1,this.showExterno=!1,this.optionValue="",this.rows.forEach((function(e){e.cantSelected=0})),this.$root.$emit("refresh_order_permission")},cargarSelectInternoExterno:function(){1==this.order.note_delivery_general[0].tipo&&(this.optionValue=this.order.note_delivery_general[0].tipo,this.nameInterno=this.order.note_delivery_general[0].request_user.name,this.last_nameInterno=this.order.note_delivery_general[0].request_user.last_name),2==this.order.note_delivery_general[0].tipo&&(this.optionValue=this.order.note_delivery_general[0].tipo,this.name=this.order.note_delivery_general[0].request_user.name,this.last_name=this.order.note_delivery_general[0].request_user.last_name),console.log(this.order)}},mounted:function(){this.$store.dispatch("users/getUsers"),console.log(this.order),this.cargarTable(),this.cargarSelectInternoExterno()}},v=b,f=a("2877"),_=a("3b73"),q=a("4074"),g=a("0170"),y=a("f09f"),x=a("a370"),w=a("eaac"),I=a("9c40"),k=a("24e8"),C=a("eb85"),S=a("0378"),E=a("ddd8"),Q=a("66e5"),$=a("27f9"),M=a("8f8e"),O=a("7f67"),T=a("eebe"),N=a.n(T),D=Object(f["a"])(v,d,u,!1,null,null,null),R=D.exports;N()(D,"components",{QExpansionItem:_["a"],QItemSection:q["a"],QItemLabel:g["a"],QCard:y["a"],QCardSection:x["a"],QTable:w["a"],QBtn:I["a"],QDialog:k["a"],QSeparator:C["a"],QForm:S["a"],QSelect:E["a"],QItem:Q["a"],QInput:$["a"],QCheckbox:M["a"]}),N()(D,"directives",{ClosePopup:O["a"]});var F={data:function(){return{orders:[]}},components:{header_vel:c["a"],poCard:R},computed:{user:{get:function(){var e=this.$store.getters["auth/user"];return e}}},watch:{},methods:{cargarOrdenes:function(){var e=this;return l()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("order/getorder");case 2:return t.next=4,e.$store.getters["order/orders"];case 4:e.orders=t.sent,console.log("Orders",e.orders);case 6:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this;this.cargarOrdenes(),this.$root.$on("refresh_order_permission",(function(){e.cargarOrdenes(),console.log("Permiso Especial")}))}},P=F,A=a("1c1c"),V=Object(f["a"])(P,n,o,!1,null,null,null),j=V.exports;N()(V,"components",{QCard:y["a"],QList:A["a"]});var z={components:{permission:j}},L=z,Y=a("9989"),U=Object(f["a"])(L,s,r,!1,null,null,null);t["default"]=U.exports;N()(U,"components",{QPage:Y["a"]})}}]);