(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{a8a7:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",[a("create")],1)},n=[],s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("header_vel",[t._v("\n        Nuevo Acp\n    ")]),a("q-btn",{attrs:{label:"historial",icon:"add"},on:{click:function(e){return t.$router.push("/acp")}}}),a("div",[a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}]},[a("div"),a("div",[a("q-input",{attrs:{outlined:"",label:"evaluacion tecnica","label-color":"black"},model:{value:t.tech_evaluation,callback:function(e){t.tech_evaluation=e},expression:"tech_evaluation"}})],1),a("div",[a("q-input",{attrs:{outlined:"",label:"evaluacion ecomonica","label-color":"black"},model:{value:t.economic_evaluation,callback:function(e){t.economic_evaluation=e},expression:"economic_evaluation"}})],1),a("div",[a("q-input",{attrs:{outlined:"",label:"recomendacion general","label-color":"black"},model:{value:t.recomendation,callback:function(e){t.recomendation=e},expression:"recomendation"}})],1),a("div",{staticClass:"row"},[a("div",{staticClass:"col-6"},[t.acps.length>0?a("q-btn",{staticClass:"full-width",attrs:{label:"regresar",color:"red",icon:"chevron_left"},on:{click:function(e){t.show=!t.show}}}):t._e()],1),a("div",{staticClass:"col-6"},[t.acps.length>0?a("q-btn",{staticClass:"full-width",attrs:{label:"guardar",color:"secondary","icon-right":"send"},on:{click:t.save}}):t._e()],1)])]),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.show,expression:"!show"}]},[a("q-select",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{multiple:"","bg-color":"white",outlined:"","use-chips":"",options:t.material_pending,"option-value":function(t){return Object(t)===t&&"id"in t?t.id:null},"option-label":function(t){return Object(t)===t&&"name"in t?t.name:""},"emit-value":"","map-options":"",label:"Productos pendientes"},scopedSlots:t._u([{key:"option",fn:function(e){return[a("q-item",t._b({},"q-item",e.itemProps,!1),[a("q-item-section",{on:{click:function(a){!e.selected&&t.materials.push(e.opt)}}},[a("q-item-label",[t._v(t._s(e.opt.name))])],1),1===e.opt.priority?a("q-item-section",{attrs:{avatar:""}},[a("q-item-label",{staticClass:"text-red"},[t._v("URGENTE  "),a("q-icon",{staticClass:"text-red",attrs:{name:"priority_high"}})],1)],1):t._e()],1)]}}]),model:{value:t.materials,callback:function(e){t.materials=e},expression:"materials"}}),t.material_pending.length>0?a("div",t._l(t.material_pending,(function(e,i){return a("materialCard",{key:i,attrs:{material:e},on:{setAplicant:t.set_aplicants}})})),1):t._e(),t.acps.length>0?a("q-btn",{staticClass:"full-width",attrs:{label:"continuar",color:"secondary","icon-right":"navigate_next"},on:{click:function(e){t.show=!t.show}}}):t._e()],1)])])],1)},o=[],r=(a("159b"),a("c740"),a("b0c0"),a("4e82"),a("a434"),a("0033")),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("q-card",{staticClass:"  item-vel full-width"},[1===t.material.priority?a("div",{staticClass:"ribbon slant-down up",staticStyle:{"--color":"red"}},[a("div",{staticClass:"content"},[a("q-icon",{attrs:{name:"priority_high"}})],1)]):t._e(),a("q-card-section",[t.hiddenNotifi?a("notificationsCounterForIten",{attrs:{url:"acp/create",num:t.material.demands[0].id}}):t._e(),a("div",{staticClass:"row"},[a("div",{staticClass:" col-9 content_item "},[a("q-item-label",[t._v(t._s(t.material.name))]),a("q-item-label",[t._v(" pendientes:"+t._s(t.material.pending_quantity))])],1),a("div",{staticClass:"col-3"},[a("q-checkbox",{attrs:{color:"green"},model:{value:t.check,callback:function(e){t.check=e},expression:"check"}})],1)])],1),t.check?a("q-card-section",[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 row justify-center"},[a("edit",{attrs:{material:t.material},on:{pending:t.set_pending}}),a("q-btn",{staticStyle:{"font-size":"1em"},attrs:{"no-caps":"",icon:"add"},on:{click:function(e){t.add=!t.add}}})],1)]),a("q-btn",{staticClass:"primary full-width",attrs:{label:"mostrar provedores"},on:{click:function(e){t.show=!t.show}}})],1):t._e()],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}]},[a("acpForm",{attrs:{material_id:t.material.id,inventory_id:t.material.inventory_id},on:{setAplicants:t.set}})],1),a("q-dialog",{model:{value:t.add,callback:function(e){t.add=e},expression:"add"}},[a("addMaterials",{attrs:{material:t.material},on:{newDemand:t.addDemand}})],1)],1)},l=[],c=(a("a4d3"),a("e01a"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("q-card",[a("q-card-section",{staticClass:"text-h6 text-center bg-primary text-white"},[t._v("\n          agregar materiales\n    ")]),a("q-card-section",{staticClass:"text-h6 text-center text-primary"},[t._v("\n         Cantidad actual "+t._s(t.material.pending_quantity)+"\n    ")]),a("q-card-section",{staticClass:"text-h6 text-center text-primary"},[a("q-input",{attrs:{label:"cantidad a ingresar",type:"number"},model:{value:t.quantity,callback:function(e){t.quantity=e},expression:"quantity"}})],1),a("q-card-section",{staticClass:"text-h6 text-center text-primary"},[a("q-btn",{attrs:{label:"guardar"},on:{click:function(e){return t.save()}}})],1)],1)],1)}),u=[],m={data:function(){return{quantity:null}},props:["material"],methods:{save:function(){var t=this;if(this.quantity<this.material.pending_quantity)this.$q.notify({message:"debe ser mayor al actual",color:"red",position:"right"});else{this.quantity=this.quantity-this.material.pending_quantity;var e={id:this.material.id,quantity:this.quantity};axios.post("demand/for_stock",e).then((function(e){var a={demand:e.data,demand_id:e.data.id,quantity:t.quantity};t.$store.commit("demands/setNewDemands",e.data),t.$emit("newDemand",a)}))}}}},p=m,h=a("2877"),_=a("f09f"),v=a("a370"),f=a("27f9"),g=a("9c40"),q=a("eebe"),y=a.n(q),b=Object(h["a"])(p,c,u,!1,null,null,null),w=b.exports;y()(b,"components",{QCard:_["a"],QCardSection:v["a"],QInput:f["a"],QBtn:g["a"]});var x=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("q-btn",{attrs:{icon:"edit"},on:{click:function(e){t.showModal=!t.showModal}}}),a("q-dialog",{model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[a("q-card",[a("q-form",{staticClass:"q-gutter-md",on:{submit:t.save}},[t._l(t.material.demands,(function(e,i){return a("q-card-section",{key:i},[a("div",{staticClass:"q-pa-sm"},[t._v("\n            numero de control:"+t._s(e.control_number)+"\n            \n            ")]),a("div",{staticClass:"q-pa-sm"},[t._v("\n                  Solicitud:"+t._s(e.description)+"\n             "),a("q-checkbox",{attrs:{label:"seleccionado"},model:{value:t.new_quantity[e.id].select,callback:function(a){t.$set(t.new_quantity[e.id],"select",a)},expression:"new_quantity[item.id].select"}})],1),a("div",[a("q-input",{attrs:{label:"cantidad solicitadas",rules:[function(a){return a<=t.new_quantity[e.id].pending_quantity_rule||"El numero no puede ser mayor al actual"}],type:"number"},model:{value:t.new_quantity[e.id].pending_quantity,callback:function(a){t.$set(t.new_quantity[e.id],"pending_quantity",a)},expression:"new_quantity[item.id].pending_quantity"}})],1)])})),a("q-btn",{attrs:{label:"enviar",type:"submit"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"cerrar"}})],2)],1)],1)],1)},C=[],k=a("9523"),$=a.n(k),Q=a("ded3"),E=a.n(Q),I=(a("13d5"),a("07ac"),{data:function(){return{showModal:!1,new_quantity:[]}},methods:{set:function(){this.new_quantity=this.material.material.reduce((function(t,e){return E()(E()({},t),{},$()({},e.demand_id,{pending_quantity:e.pending_quantity,pending_quantity_rule:e.pending_quantity,id:e.id,demand_id:e.demand_id,select:e.select}))}),{})},save:function(){var t=Object.values(this.new_quantity);this.$store.commit("demands/ModifyPending",t);var e=0,a=[];t.forEach((function(t){t.select&&(e+=parseInt(t.pending_quantity));var i={id:t.demand_id,select:t.select};a.push(i)})),this.$emit("pending",{pending_quantity:e,id:a})}},props:["material"],created:function(){this.set(),this.$root.$on("suppliers_set",this.set)}}),j=I,M=a("24e8"),N=a("0378"),S=a("8f8e"),O=a("7f67"),D=Object(h["a"])(j,x,C,!1,null,null,null),P=D.exports;y()(D,"components",{QBtn:g["a"],QDialog:M["a"],QCard:_["a"],QForm:N["a"],QCardSection:v["a"],QCheckbox:S["a"],QInput:f["a"]}),y()(D,"directives",{ClosePopup:O["a"]});var F=a("e93a"),A={name:"CardMaterials",data:function(){return{show:!1,maximizedToggle:!0,check:!1,applicants:[],add:!1,hiddenNotifi:!0}},components:{acpForm:r["a"],addMaterials:w,edit:P,notificationsCounterForIten:F["a"]},props:["material"],watch:{check:function(t){t&&(this.$store.commit("auth/remove_notifications_acp",this.material.demands[0].id),this.hiddenNotifi=!1)}},computed:{material_pending:{get:function(){return this.$store.getters["demands/material"]}}},methods:{set:function(t){var e=this;this.check=!0,this.material.demands_id.forEach((function(a){var i={demand_id:a,applicants:[],select:e.check,justification:null,tech_evaluation:null,economic_evaluation:null,recomendation:null};t.forEach((function(t){e.$store.commit("demands/setMaterialPending",{id:a,inventory_id:t.inventory_id,material_id:t.material_id});var n={material_id:e.material_pending?e.material_pending.id:t.material_id,demand_id:a,delivery:t.delivery,price:t.price,supplier_id:t.supplier_id,validity:t.validity,recomendation:t.recomendation,description:t.description,quantity:e.material_pending.pending_quantity};i.applicants.push(n),e.$store.commit("demands/clearMaterialPending")})),e.applicants.push(i)})),this.show=!1,this.$emit("setAplicant",this.applicants)},addDemand:function(t){this.material.demands_id.push(t.demand_id),this.material.demands.push(t.demand),this.material.material.push(t.demand.materials_pending[0]),this.material.pending_quantity=this.material.pending_quantity+t.quantity,this.add=!1,this.$root.$emit("set_supplier")},set_pending:function(t){var e=this;this.material.pending_quantity=t.pending_quantity,t.id.forEach((function(t){var a=e.material.demands_id.indexOf(t.id);if(a>-1){if(!t.select){e.material.demands_id.splice(a,1);var i=e.material.material.findIndex((function(e){return e.demand_id===t}));e.material.material[i].select=!1}}else if(t.select){e.material.demands_id.push(t.id);var n=e.material.material.findIndex((function(e){return e.demand_id===t}));e.material.material[n].select=!0}}))}},mounted:function(){var t=this;console.log("Material ACP",this.material.demands[0].id),this.$root.$on("close_delete",(function(){t.showDelete=!1})),this.$root.$on("acpCard_refresh",(function(){t.$store.dispatch("acps/getacps")}))}},B=A,z=a("0016"),T=a("0170"),J=Object(h["a"])(B,d,l,!1,null,null,null),L=J.exports;y()(J,"components",{QCard:_["a"],QIcon:z["a"],QCardSection:v["a"],QItemLabel:T["a"],QCheckbox:S["a"],QBtn:g["a"],QDialog:M["a"]});var G=a("d784d"),R=a("bc3a"),U=a.n(R),H={data:function(){return{showModal:!1,maximizedToggle:!0,suppliers:null,suppliers_id:[],show:!1,justification:"justificacion",tech_evaluation:null,economic_evaluation:null,recomendation:null,demands:[],materials:[],applicants:[],material_pending:[],acps:[]}},watch:{demands:function(t){}},components:{acpsForm:r["a"],header_vel:G["a"],materialCard:L},computed:{demands_pending:{get:function(){return this.$store.getters["demands/pending"]}}},methods:{save:function(){var t=this;this.justification?(this.acps.forEach((function(e){e.justification=t.justification,e.tech_evaluation=t.tech_evaluation,e.economic_evaluation=t.economic_evaluation,e.recomendation=t.recomendation})),this.$q.loading.show(),U.a.post("acp/store",{acps:this.acps}).then((function(e){console.log(e),t.$q.loading.hide(),t.$router.push({name:"acp"})})).catch((function(e){t.$q.loading.hide(),console.log(e)}))):this.$q.notify({message:"debe colocar una justificacion",color:"red",position:"right"})},getSuppliers:function(){var t=this;U.a.get("supplier/index").then((function(e){t.suppliers=e.data}))},set_materials:function(){var t=this;this.materials=[];var e=this;this.demands_pending.forEach((function(a){a.materials_pending.forEach((function(t){if(null!=t.inventory_id){var i=e.material_pending.findIndex((function(e){return t.inventory_id===e.inventory_id}));if(-1!=i)e.material_pending[i].pending_quantity=e.material_pending[i].pending_quantity+t.pending_quantity,e.material_pending[i].demands_id.push(t.demand_id),e.material_pending[i].demands.push(a),t["select"]=!0,e.material_pending[i].material.push(t),e.material_pending[i].priority=1===e.material_pending[i].priority?1:a.priority;else if(t.pending_quantity>0){var n={name:t.name,inventory_id:t.inventory_id,id:t.id,pending_quantity:t.pending_quantity,demands_id:[],demands:[],material:[],priority:a.priority};n.demands_id.push(t.demand_id),t["select"]=!0,n.material.push(t),n.demands.push(a),e.material_pending.push(n)}}else if(t.pending_quantity>0){var s={name:t.name,inventory_id:t.inventory_id,id:t.id,pending_quantity:t.pending_quantity,demands_id:[],demands:[],material:[],priority:a.priority};s.demands_id.push(t.demand_id),s.demands.push(a),t["select"]=!0,s.material.push(t),e.material_pending.push(s)}})),t.material_pending.sort((function(t,e){return e.priority-t.priority}))}))},set_aplicants:function(t){var e=this;t.forEach((function(t){if(e.acps.length>0){var a=e.acps.findIndex((function(e){return e.demand_id===t.demand_id}));if(-1!=a){var i=e;t.applicants.forEach((function(t){var e=i.acps[a].applicants.findIndex((function(e){return e.material_id===t.material_id&&e.supplier_id==t.supplier_id}));-1!=e&&i.acps[a].applicants.splice(e,1),i.acps[a].applicants.push(t)}))}else e.acps.push(t)}else e.acps.push(t)})),console.log(this.acps)}},mounted:function(){var t=this;console.log("pendiente",this.demands_pending),this.getSuppliers(),this.$store.dispatch("demands/get_pending").then((function(e){t.set_materials()})),this.$root.$on("acps_refresh",(function(){t.$store.dispatch("demands/get_pending"),t.showModal=!1}))}},K=H,V=K,W=V,X=a("ddd8"),Y=a("66e5"),Z=a("4074"),tt=Object(h["a"])(W,s,o,!1,null,null,null),et=tt.exports;y()(tt,"components",{QBtn:g["a"],QInput:f["a"],QSelect:X["a"],QItem:Y["a"],QItemSection:Z["a"],QItemLabel:T["a"],QIcon:z["a"]});var at={components:{create:et}},it=at,nt=a("9989"),st=Object(h["a"])(it,i,n,!1,null,null,null);e["default"]=st.exports;y()(st,"components",{QPage:nt["a"]})}}]);